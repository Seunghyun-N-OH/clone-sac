<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <th:block th:insert="/fragments/global::head-links"/>
    <link rel="stylesheet" href="/styles/pages/members/join-1.css" />
    <title>Document</title>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        var pwRule = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[$`~!@$!%*#^?&\\(\\)\-_=+]).{10,20}$/;     //  10~20자, 대문자,소문자,숫자,특수문자 최소 1개 포함
        var idRule = /^(?=.*[a-z])(?=.*[0-9]).{8,16}$/;        //  8~16자, 대문자불가, 숫자 포함 가능
        var mailRule = /^[a-z0-9_+.-]+@([a-z0-9-]+\.)+[a-z0-9]{2,4}$/;
        var phoneRule = /^(?=.*[0-9]).{4}$/;
        var whiteSpaceCheck = /\s/;

        $(function(){
            $("#userpwInput").focusout(pwRuleCheck);
            $("#userpwInput-doublecheck").focusout(pwDoubleCheck);
            $("#findPostal").click(startDaumAPI);
            $("#postal").click(startDaumAPI);
            $("#address1").click(startDaumAPI);
        })

        function nextPageCheck(){
            if(!genderCheck()){
                return false;
            }
            if(!checkIdAvailability()){
                alert("아이디를 다시 확인 후 중복확인을 해주세요");
                return false;
            }
            if(!pwRuleCheck()){
                alert("필수입력정보 : 비밀번호를 정확하게 입력해주세요.\n10~20자, 대문자,소문자,숫자,특수문자 최소 각 1개 포함");
                return false;
            }
            if(!pwDoubleCheck()){
                alert("필수입력정보 : 비밀번호 확인을 정확하게 입력해주세요.");
                return false;
            }
            if($("#postal").val() == null){
                alert("필수입력정보 : 주소를 입력해 주세요.");
                return false;
            }
            if(!phoneNumberCheck()){
                alert("필수입력정보 : 연락처를 정확하게 입력해주세요.");
                return false;
            }
            if(!emailRuleCheck()){
                alert("필수입력정보 : 이메일을 정확하게 입력해주세요.");
                return false;
            }
            if(!feeCheck()) return false;
            if(!$("#mail-yes").is(":checked")){
                $("#mail-no").prop("checked", true);
            }
            if(!$("#sms-yes").is(":checked")){
                $("#sms-no").prop("checked", true);
            }
            $("#joinBox").submit();
            // document.getElementById("joinBox").submit();

        }

        function feeCheck(){
            if($("#fee > option#defaultSelect:selected").val()){
                alert("가입하시는 회원등급의 회비를 확인 후 선택해주세요.");
                return false;
            } else {
                return true;
            }
        }

    function emailRuleCheck(){
        var emailInput = $("#email").val();
        if(mailRule.test(emailInput)){
            $("emailCheckMSG").text("");
            return true;
        } else {
            $("emailCheckMSG").text("이메일을 정확하게 입력해주세요");
            return false;
        }
    }

    function phoneNumberCheck(){
        var phone2 = $("#phone2").val();
        var phone3 = $("#phone3").val();
        if(!whiteSpaceCheck.test(phone2) && !whiteSpaceCheck.test(phone3)){
            // 연락처 가운데, 마지막 번호에 공백이 없을 경우
            if(phoneRule.test(phone2)&&phoneRule.test(phone3)){
                $("#phoneCheckMSG").text("");
                return true;
            } else {
                $("#phoneCheckMSG").css("color", "red");
                $("#phoneCheckMSG").text("연락처를 정확하게 입력해주세요.");
                return false;
                // 모든 사람들의 연락처가 반드시 010-XXXX-XXXX 자릿수라는 가정
            }
        } else {
            $("#phoneCheckMSG").css("color", "red");
            $("#phoneCheckMSG").text("연락처를 공백없이 입력해주세요.");
            return false;
        }
    }

    function startDaumAPI(){
            // opens new window when cliking "주소 찾기" using Kakao API
            new daum.Postcode({
                oncomplete: function(data) { // returns Object 'data' that includes all info. of the selected address
                    // pick & get specific info. from 'data', and put them in proper element for each
                    document.getElementById("postal").value=data.zonecode; // zip code 
                    document.getElementById("address1").value = data.address + " (" + data.buildingName + ")";
                    // address + ( building name )
                    document.getElementById("address2").focus();
                    // focus to input box which visitors should type in by themselves
                }
            }).open();
        }

    function pwDoubleCheck(){
        var curPW = $("#userpwInput").val();
        var doubleCheck = $("#userpwInput-doublecheck").val();
        if(curPW == doubleCheck){
            $("#doublecheckMSG").text("");
            return true;
        } else {
            $("#doublecheckMSG").css("color", "red");
            $("#doublecheckMSG").text("비밀번호가 일치하지 않습니다.");
            return false;
        }
    }

    function pwRuleCheck(){
        var curPW = $("#userpwInput").val();
        if(pwRule.test(curPW) && !whiteSpaceCheck.test(curPW)){
            $("#pwLine").css("height" , "4rem");
            $("#pwName").css("height" , "4rem");
            $("#pwValue").css("height" , "4rem");
            $("#pwCheckResult").hide();
            return true;
        } else {
            $("#pwLine").css("height" , "5rem");
            $("#pwName").css("height" , "5rem");
            $("#pwValue").css("height" , "5rem");
            $("#pwCheckResult").show();
            $("#pwCheckResult").css("color", "red");
            $("#pwCheckResult").text("사용하실 수 없는 비밀번호입니다.");
            return false;
        }
    }

    function genderCheck(){
        if(!document.getElementById("male").checked &&!document.getElementById("female").checked){
            alert("성별을 선택해주세요.");
            return false;
        } else {
            return true;
        }
    }

    function checkIdAvailability(){
        var curId = $("#useridInput").val();
        if(idRule.test(curId) && !whiteSpaceCheck.test(curId)){
            // 유효한 아이디, 공백미포함+규칙준수
            $("#idLine").css("height" , "5rem");
            $("#idName").css("height" , "5rem");
            $("#idValue").css("height" , "5rem");
            $("#idCheckResult").css("color", "green");
            $("#idCheckResult").show();
            $("#idCheckResult").text("사용할 수 있는 아이디입니다.");
            return true;
        } else {
            $("#idLine").css("height" , "5rem");
            $("#idName").css("height" , "5rem");
            $("#idValue").css("height" , "5rem");
            $("#idCheckResult").css("color", "red");
            $("#idCheckResult").show();
            $("#idCheckResult").text("사용할 수 없는 아이디형식입니다. 8~16자, 영소문자,숫자 만 입력가능");
            return false;
        }

        $.ajax({
            type : "GET",
            url : "/member/signup/checkidavailability",
            data : {
                tempID : curId,
            },
            success : function(res){
                $("#idLine").css("height" , "5rem");
                $("#idName").css("height" , "5rem");
                $("#idValue").css("height" , "5rem");
                if(res = "true"){      // returns true if ID is available
                    $("#idCheckResult").show();
                    $("#idCheckResult").css("color", "green");
                    $("#idCheckResult").text("사용 가능한 아이디입니다.");
                } else {                // if not, returns false
                    $("#idCheckResult").show();
                    $("#idCheckResult").css("color", "red");
                    $("#idCheckResult").text("이미 사용중인 아이디입니다.");
                }
            }
        })


    }
    </script>
  </head>
  <body>
    <th:block th:insert="~{/fragments/global::global(~{this::main})}">
      <main>
        <section class="themeArea">
          <h4>&nbsp;</h4>
          <h3>회원서비스</h3>
        </section>
        <section class="navigator">
          <div class="navsizebox">
            <div class="navigate">
              <a class="navHome" href="/"
                ><img src="/imgsrc/assets/cwac-menu_icon01.png" alt=""
              /></a>
              <a class="navSelect" href="#">회원서비스</a>
              <a class="navSelect" href="#">회원가입 정보입력</a>
            </div>
            <div class="actions">
              <a class="printicon" href="#"
                ><img src="/imgsrc/assets/cwac-menu_icon03.png" alt=""
              /></a>
              <a class="shareicon" href="#"
                ><img src="/imgsrc/assets/cwac-menu_icon04.png" alt=""
              /></a>
            </div>
          </div>
        </section>
        <section class="pageContents">
          <div class="pageTitle">
            <p>회원가입 정보입력</p>
          </div>
          <div class="maincontents">
              <!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
            <div class="processNlogo">
                <div class="logoline">
                    <img src="/imgsrc/assets/join/member_ogo.gif" alt="">
                </div>
                <div class="process1">
                    <ul>
                        <li class="first"><img src="/imgsrc/assets/join/member_bg1.png" alt="">회원약관동의</li>
                        <li class="second"><img src="/imgsrc/assets/join/member_bg2.png" alt="">인증</li>
                        <li class="third"><img src="/imgsrc/assets/join/member_bg3on.png" alt="">정보입력</li>
                        <li class="forth"><img src="/imgsrc/assets/join/member_bg4.png" alt="">가입완료</li>
                    </ul>
                </div>
            </div>
            <!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
            <div class="terms">
                <span class="sectionTitle">정보입력</span>
                <div class="termBox">
                    <span class="termTitle">회원 상세 정보 입력(*는 필수 입력 정보)</span>
                    <form th:action="@{/member/signup/step4}" id="joinBox" method="post">
                        <div class="dataLine tableTop">
                            <span class="dataName">성명<span class="red-font">*</span></span>
                            <span class="dataValue" >[[${name}]]</span>
                            <input type="text" name="name" th:value="${name}" hidden>
                        </div>
                        <div class="dataLine">
                            <span class="dataName">생년월일<span class="red-font">*</span></span>
                            <span class="dataValue" >
                                <input type="hidden" name="birthDate" th:value="${birthday}">
                                [[${birthday}]]
                                <input type="radio" name="calendar" id="solar" class="customRadio" value="s" checked>
                                <label for="solar" class="customRadioLabel">양력</label>
                                <input type="radio" name="calendar" id="lunar" class="customRadio" value="l">
                                <label for="lunar" class="customRadioLabel">음력</label>
                            </span>
                        </div>
                        <div class="dataLine">
                            <span class="dataName">성별<span class="red-font">*</span></span>
                            <span class="dataValue">
                                <input style="margin-left : 0" type="radio" name="gender" id="male" value="m" class="customRadio">
                                <label for="male" class="customRadioLabel">남자</label>
                                <input type="radio" name="gender" id="female" value="f" class="customRadio">
                                <label for="female" class="customRadioLabel">여자</label>
                            </span>
                        </div>
                        <div class="dataLine" id="idLine">
                            <span class="dataName" id="idName">아이디<span class="red-font">*</span></span>
                            <span class="dataValue" id="idValue" style="display : flex; flex-direction: column; align-items : flex-start;">
                                <div style="display:flex; flex-direction:row ; justify-content: start; align-items: center;">
                                    <input class="idinput" type="text" name="userId" id="useridInput">
                                    <button onclick="checkIdAvailability()" class="joinBTN" type="button" style="margin-right : 1rem"><img src="/imgsrc/assets/join/yes_btn.gif" alt="">중복 확인</button>
                                    8~16자리를 입력해야 합니다.
                                </div>
                                <span style="margin-top : 0.25rem" id="idCheckResult" hidden>test</span>
                            </span>
                        </div>
                        <div class="dataLine">
                            <div class="dataName" id="pwName"><span>비밀번호<span class="red-font">*</span></span></div>
                            <span class="dataValue" id="pwValue" style="display : flex; flex-direction: column; align-items : flex-start;">
                                <div style="display:flex; flex-direction:row ; justify-content: start; align-items: center;">
                                    <input class="pwinput" type="password" name="userPw" id="userpwInput">
                                    10~20자, 대문자,소문자,숫자,특수문자 최소 각 1개 포함
                                </div>
                                <span style="margin-top : 0.25rem" id="pwCheckResult" hidden>test</span>
                            </span>
                        </div>
                        <div class="dataLine">
                            <span class="dataName">비밀번호 확인<span class="red-font">*</span></span>
                            <span class="dataValue">
                                <input class="pwinput" type="password" id="userpwInput-doublecheck">
                                <span style="margin-left : 1rem" id="doublecheckMSG"></span>
                            </span>
                        </div>
                        <div class="dataLine">
                            <div style="height : 9rem" class="dataName"><span>주소<span class="red-font">*</span></span></div>
                            <div class="dataValue columns" style="height: 9rem;">
                                <div >
                                    <input type="text" name="addressPostal" id="postal" readonly>
                                    <button id="findPostal" class="joinBTN" type="button"><img src="/imgsrc/assets/join/postal-no-btn.gif" alt="">주소 검색</button>
                                </div>
                                <input class="ninetywidth" style="display : block;margin-top : 0.5rem; margin-bottom:0.5rem" type="text" name="address_1" id="address1" readonly>
                                <input class="ninetywidth" style="display : block" type="text" name="address_2" id="address2" placeholder="주소검색 후 상세주소(동, 호수 등)를 입력해주세요.">
                            </div>
                        </div>
                        <div class="dataLine">
                            <span class="dataName">연락처(휴대폰 번호)<span class="red-font">*</span></span>
                            <span class="dataValue">
                                <select class="selectInput" name="phone1" id="phone1">
                                    <option value="010">010</option>
                                    <option value="011">011</option>
                                    <option value="012">012</option>
                                </select>
                                <input type="text" name="phone2" id="phone2">
                                <input type="text" name="phone3" id="phone3">
                                <span style="margin-left : 1rem" id="phoneCheckMSG"></span>
                            </span>
                        </div>
                        <div class="dataLine">
                            <span class="dataName">이메일<span class="red-font">*</span></span>
                            <span class="dataValue">
                                <input style="width: 40%;" type="email" name="email" id="email">
                                <span style="margin-left : 1rem" id="emailCheckMSG"></span>
                            </span>
                        </div>
                        <div class="dataLine">
                            <span class="dataName">이메일 수신여부</span>
                            <span class="dataValue">
                                <input type="radio" class="customRadio" name="marketing_email" id="mail-yes" value="y">
                                <label for="mail-yes" class="customRadioLabel">예</label>
                                <input type="radio" class="customRadio" name="marketing_email" id="mail-no" value="n">
                                <label for="mail-no" class="customRadioLabel">아니오</label>
                            </span>
                        </div>
                        <div class="dataLine" style="margin-bottom : 2%">
                            <span style="height : 17rem"  class="dataName">SMS 수신여부</span>
                            <span style="height : 17rem" class="dataValue columns">
                                <div class="labelDiv">
                                    <input type="radio" class="customRadio" name="marketing_sms" id="sms-yes" value="y">
                                    <label for="sms-yes" class="customRadioLabel">예</label>
                                    <input type="radio" class="customRadio" name="marketing_sms" id="sms-no" value="n">
                                    <label for="sms-no" class="customRadioLabel">아니오</label>
                                </div>
                                <ul class="outerList">
                                    <li>
                                        개인정보보호법 제22조 제3항에 따라 <마케팅 활용에 관한 동의>를 받고자 합니다.
                                        <ul class="innerList">
                                            <li>1. 수집목적 : 예술의전당 기획공연, 이벤트, 할인안내 동의 다양한 정보 제공</li>
                                            <li>2. 보유기간 : 개인정보 보유기간 만료시까지, 동의 유지기간 동안.</li>
                                            <li>3. 이용항목 : 휴대폰 번호, 이메일 주소 (동의사항에 한함)</li>
                                            <li>4. 동의거부시 불이익 : 고객은 동의를 거부할 권리가 있으며, 동의하지 않으실 경우 수집목적에 따른 이벤트 할인안내 등의 정보를 제공받을 수 없습니다.</li>
                                        </ul>
                                    </li>
                                    <li>유료멤버십 골드, 블루, 그린회원에 가입하실 때 SMS 수신 동의시 주요공연의 티켓오픈일자와 할인정보를 보내드립니다.<br>회원정보, 예매, 결제정보 및 서비스 중 정책 관련 내용은 수신동의 여부와 관계없이 발송됩니다.</li>
                                </ul>
                            </span>
                        </div>

                        <span class="sectionTitle" style="border: none">회원등급 가입</span>
                        <div class="dataLine tableTop">
                            <div style="height : 6.5rem" class="dataName"><span>무료회원</span></div>
                            <div class="dataValue columns" style="height: 6.5rem;">
                                <select  class="feeSelect" style="display : block;margin-bottom:0.5rem" name="fee" id="fee">
                                    <option id="defaultSelect" selected>==== 회비선택 ====</option>
                                    <option value="free">무료</option>
                                </select>
                                <input style="display : block ; width : 20%" type="text" id="fee-detail" disabled>
                            </div>
                        </div>
                        <p style="margin-top : 0.5rem;" class="red-font quinze">* 유료회원(골드/블루) 가입 시 회원카드와 회원물품은 입력하신 주소지로 자동배송 됩니다. (1~2주 이내)<br>* 유니온페이 제휴회원 가입은 예술의전당 고객센터(02-580-1300)에서만 가능합니다.</p>
                        <input type="text" name="centerTerm" th:value="${center}" hidden>
                        <input type="text" name="personalTerm" th:value="${personal}" hidden>
                        <input type="text" name="marketingTerm" th:value="${marketing}" hidden>
                        <input  type="text" name="memberType" th:value="${memberType}" hidden>
                        <div class="buttons">
                            <button class="red-border red-font" type="button" onclick="nextPageCheck()">가입하기</button>
                            <button type="button">취소</button>
                        </div>
                    </form>
                </div>
            </div>
          </div>
        </section>
      </main>
    </th:block>
  </body>
</html>